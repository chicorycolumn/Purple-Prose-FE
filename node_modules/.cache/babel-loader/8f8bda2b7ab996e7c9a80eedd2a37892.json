{"ast":null,"code":"var _jsxFileName = \"/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx\";\nimport React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\"; //The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      voteBuffer: 0,\n      error: false\n    };\n\n    this.sneakyUpwardChange = article_votes_junction => {\n      this.setState({\n        voteBuffer: article_votes_junction[0][\"inc_votes\"]\n      });\n    };\n\n    this.handleVote = voteDirection => {\n      if (this.props.currentUser !== null && this.props.currentUser !== undefined && this.props.currentUser !== \"\") {\n        const {\n          article_id,\n          currentUser\n        } = this.props; //Undoing the invalid double-vote the user just gave.\n\n        voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n          this.setState(currState => {\n            return {\n              error: true,\n              voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1)\n            };\n          });\n        }); //Ambicrementing the vote regardless.\n\n        this.setState(currState => {\n          return {\n            voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n            error: false\n          };\n        }); // let newCastedVote = this.state.voteBuffer;\n        // if (newCastedVote < 1 && voteDirection === 1) {\n        //   newCastedVote++;\n        // } else if (newCastedVote > -1 && voteDirection === -1) {\n        //   newCastedVote--;\n        // }\n        // this.setState({ voteBuffer: newCastedVote });\n      } else {\n        alert(\"To vote on the latest news, log in or sign up!\");\n      }\n    };\n  }\n\n  componentDidMount() {\n    queryUserVoteOnArticle(this.sneakyUpwardChange, this.props.currentUser, this.props.article_id);\n  }\n\n  render() {\n    return React.createElement(\"p\", {\n      className: styles.votes,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68\n      },\n      __self: this\n    }, this.state.voteBuffer === 1 ? \"▲\" : \"▵\"), console.log(`this.state.voteBuffer is ${this.state.voteBuffer}`), console.log(`this.props.votes is ${this.props.votes}`), React.createElement(\"p\", {\n      className: styles.voteCount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    }, this.props.votes || 0), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(-1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, this.state.voteBuffer === -1 ? \"▼\" : \"▿\"));\n  }\n\n}\n\nexport default VoteDisplayOnArticle;","map":{"version":3,"sources":["/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx"],"names":["React","Component","voteOnArticle","styles","queryUserVoteOnArticle","VoteDisplayOnArticle","state","voteBuffer","error","sneakyUpwardChange","article_votes_junction","setState","handleVote","voteDirection","props","currentUser","undefined","article_id","catch","err","currState","alert","componentDidMount","render","votes","voteEmoji","console","log","voteCount"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\";\n\n//The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  state = { voteBuffer: 0, error: false };\n\n  sneakyUpwardChange = article_votes_junction => {\n    this.setState({ voteBuffer: article_votes_junction[0][\"inc_votes\"] });\n  };\n\n  componentDidMount() {\n    queryUserVoteOnArticle(\n      this.sneakyUpwardChange,\n      this.props.currentUser,\n      this.props.article_id\n    );\n  }\n\n  handleVote = voteDirection => {\n    if (\n      this.props.currentUser !== null &&\n      this.props.currentUser !== undefined &&\n      this.props.currentUser !== \"\"\n    ) {\n      const { article_id, currentUser } = this.props;\n\n      //Undoing the invalid double-vote the user just gave.\n      voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n        this.setState(currState => {\n          return {\n            error: true,\n            voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1)\n          };\n        });\n      });\n\n      //Ambicrementing the vote regardless.\n      this.setState(currState => {\n        return {\n          voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n          error: false\n        };\n      });\n\n      // let newCastedVote = this.state.voteBuffer;\n\n      // if (newCastedVote < 1 && voteDirection === 1) {\n      //   newCastedVote++;\n      // } else if (newCastedVote > -1 && voteDirection === -1) {\n      //   newCastedVote--;\n      // }\n      // this.setState({ voteBuffer: newCastedVote });\n    } else {\n      alert(\"To vote on the latest news, log in or sign up!\");\n    }\n  };\n\n  render() {\n    return (\n      <p className={styles.votes}>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer === 1 ? \"▲\" : \"▵\"}\n        </span>\n        {console.log(`this.state.voteBuffer is ${this.state.voteBuffer}`)}\n        {console.log(`this.props.votes is ${this.props.votes}`)}\n        <p className={styles.voteCount}>\n          {/* {this.state.voteBuffer + (this.props.votes || 0)} */}\n          {this.props.votes || 0}\n        </p>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(-1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer === -1 ? \"▼\" : \"▿\"}\n        </span>\n      </p>\n    );\n  }\n}\n\nexport default VoteDisplayOnArticle;\n"]},"metadata":{},"sourceType":"module"}