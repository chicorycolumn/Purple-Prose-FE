{"ast":null,"code":"var _jsxFileName = \"/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx\";\nimport React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\"; //The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      castedVote: 0,\n      error: false // hasParentRefreshed: true,\n      // castedVoteValueAtMount: 0\n\n    };\n\n    this.sneakyUpwardChange = article_votes_junction => {\n      console.log(`AVJx ${JSON.stringify(article_votes_junction)}`);\n\n      if (article_votes_junction.length === 0) {\n        this.setState({\n          castedVote: 0 // castedVoteValueAtMount: 0\n\n        });\n      } // console.log(`SUC: cast as ${article_votes_junction[0][\"inc_votes\"]}`);\n      else this.setState({\n          castedVote: article_votes_junction[0][\"inc_votes\"] // castedVoteValueAtMount: article_votes_junction[0][\"inc_votes\"]\n\n        });\n    };\n\n    this.handleVote = voteDirection => {\n      // console.log(\n      //   `beginning of handleVote, cast is ${this.state.castedVote} and voteDir is ${voteDirection}`\n      // );\n      if (!(this.props.currentUser !== null && this.props.currentUser !== undefined && this.props.currentUser !== \"\")) {\n        alert(\"To vote on the latest news, log in or sign up!\");\n      } else {\n        const {\n          article_id,\n          currentUser\n        } = this.props; //If nullifying or de novo:\n\n        if (voteDirection !== this.state.castedVote) {\n          // console.log(`sending to db...`);\n          //Send off to database.\n          voteOnArticle(currentUser, article_id, voteDirection); // .then(\n          //   this.setState(currState => {\n          //     return {\n          //       error: true,\n          //       castedVote:\n          //         currState.castedVote + (voteDirection === -1 ? 1 : -1),\n          //       hasParentRefreshed: false\n          //     };\n          //   })\n          // );\n          // console.log(this.props);\n\n          this.props.voteOnArticleUpstream(voteDirection); //Set a local change so user sees immediate (optim ren).\n\n          this.setState(currState => {\n            // console.log(\n            //   `setting local change where new cast will be ${currState.castedVote +\n            //     voteDirection}`\n            // );\n            return {\n              castedVote: currState.castedVote + voteDirection,\n              error: false // hasParentRefreshed: false\n\n            };\n          });\n        } // let newCastedVote = this.state.castedVote;\n        // if (newCastedVote < 1 && voteDirection === 1) {\n        //   newCastedVote++;\n        // } else if (newCastedVote > -1 && voteDirection === -1) {\n        //   newCastedVote--;\n        // }\n        // this.setState({ castedVote: newCastedVote });\n        //\n        // voteOnArticle(currentUser, article_id, voteDirection).then(\n        //   this.setState(currState => {\n        //     return {\n        //       error: true,\n        //       castedVote: currState.castedVote + (voteDirection === -1 ? 1 : -1),\n        //       hasParentRefreshed: false\n        //     };\n        //   })\n        // )\n\n      }\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.currentUser) {\n      queryUserVoteOnArticle(this.sneakyUpwardChange, this.props.currentUser, this.props.article_id);\n    }\n  } // componentDidUpdate(prevProps) {\n  //   // console.log(\"update\");\n  //   if (prevProps.refreshTicket !== this.props.refreshTicket) {\n  //     this.setState({ hasParentRefreshed: true });\n  //   }\n  // }\n\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.votes !== this.props.votes) {\n      this.setState({}); // Is this permissible, an empty object to force re-render?\n    }\n  }\n\n  render() {\n    // console.log(this.state.hasParentRefreshed);\n    // console.log(`CVAM ${this.state.castedVoteValueAtMount}`);\n    // console.log(\n    //   `start of render, cast:${this.state.castedVote} parentVote:${this.props.votes}`\n    // );\n    return React.createElement(\"p\", {\n      className: styles.votes,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        if (this.state.castedVote !== 1) {\n          this.handleVote(1);\n        }\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, this.state.castedVote.toString() === \"1\" ? \"▲\" : \"▵\"), React.createElement(\"p\", {\n      className: styles.voteCount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, this.props.votes), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        if (this.state.castedVote !== -1) {\n          this.handleVote(-1);\n        }\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, this.state.castedVote.toString() === \"-1\" ? \"▼\" : \"▿\"));\n  }\n\n}\n\nexport default VoteDisplayOnArticle;","map":{"version":3,"sources":["/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx"],"names":["React","Component","voteOnArticle","styles","queryUserVoteOnArticle","VoteDisplayOnArticle","state","castedVote","error","sneakyUpwardChange","article_votes_junction","console","log","JSON","stringify","length","setState","handleVote","voteDirection","props","currentUser","undefined","alert","article_id","voteOnArticleUpstream","currState","componentDidMount","componentDidUpdate","prevProps","votes","render","voteEmoji","toString","voteCount"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\";\n\n//The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  state = {\n    castedVote: 0,\n    error: false\n    // hasParentRefreshed: true,\n    // castedVoteValueAtMount: 0\n  };\n\n  sneakyUpwardChange = article_votes_junction => {\n    console.log(`AVJx ${JSON.stringify(article_votes_junction)}`);\n\n    if (article_votes_junction.length === 0) {\n      this.setState({\n        castedVote: 0\n        // castedVoteValueAtMount: 0\n      });\n    }\n\n    // console.log(`SUC: cast as ${article_votes_junction[0][\"inc_votes\"]}`);\n    else\n      this.setState({\n        castedVote: article_votes_junction[0][\"inc_votes\"]\n        // castedVoteValueAtMount: article_votes_junction[0][\"inc_votes\"]\n      });\n  };\n\n  componentDidMount() {\n    if (this.props.currentUser) {\n      queryUserVoteOnArticle(\n        this.sneakyUpwardChange,\n        this.props.currentUser,\n        this.props.article_id\n      );\n    }\n  }\n\n  // componentDidUpdate(prevProps) {\n  //   // console.log(\"update\");\n  //   if (prevProps.refreshTicket !== this.props.refreshTicket) {\n  //     this.setState({ hasParentRefreshed: true });\n  //   }\n  // }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.votes !== this.props.votes) {\n      this.setState({}); // Is this permissible, an empty object to force re-render?\n    }\n  }\n\n  handleVote = voteDirection => {\n    // console.log(\n    //   `beginning of handleVote, cast is ${this.state.castedVote} and voteDir is ${voteDirection}`\n    // );\n    if (\n      !(\n        this.props.currentUser !== null &&\n        this.props.currentUser !== undefined &&\n        this.props.currentUser !== \"\"\n      )\n    ) {\n      alert(\"To vote on the latest news, log in or sign up!\");\n    } else {\n      const { article_id, currentUser } = this.props;\n      //If nullifying or de novo:\n      if (voteDirection !== this.state.castedVote) {\n        // console.log(`sending to db...`);\n        //Send off to database.\n        voteOnArticle(currentUser, article_id, voteDirection);\n\n        // .then(\n        //   this.setState(currState => {\n        //     return {\n        //       error: true,\n        //       castedVote:\n        //         currState.castedVote + (voteDirection === -1 ? 1 : -1),\n        //       hasParentRefreshed: false\n        //     };\n        //   })\n        // );\n        // console.log(this.props);\n        this.props.voteOnArticleUpstream(voteDirection);\n        //Set a local change so user sees immediate (optim ren).\n        this.setState(currState => {\n          // console.log(\n          //   `setting local change where new cast will be ${currState.castedVote +\n          //     voteDirection}`\n          // );\n          return {\n            castedVote: currState.castedVote + voteDirection,\n            error: false\n            // hasParentRefreshed: false\n          };\n        });\n      }\n\n      // let newCastedVote = this.state.castedVote;\n\n      // if (newCastedVote < 1 && voteDirection === 1) {\n      //   newCastedVote++;\n      // } else if (newCastedVote > -1 && voteDirection === -1) {\n      //   newCastedVote--;\n      // }\n      // this.setState({ castedVote: newCastedVote });\n      //\n      // voteOnArticle(currentUser, article_id, voteDirection).then(\n      //   this.setState(currState => {\n      //     return {\n      //       error: true,\n      //       castedVote: currState.castedVote + (voteDirection === -1 ? 1 : -1),\n      //       hasParentRefreshed: false\n      //     };\n      //   })\n      // )\n    }\n  };\n\n  render() {\n    // console.log(this.state.hasParentRefreshed);\n    // console.log(`CVAM ${this.state.castedVoteValueAtMount}`);\n    // console.log(\n    //   `start of render, cast:${this.state.castedVote} parentVote:${this.props.votes}`\n    // );\n    return (\n      <p className={styles.votes}>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            if (this.state.castedVote !== 1) {\n              this.handleVote(1);\n            }\n          }}\n          role=\"img\"\n        >\n          {this.state.castedVote.toString() === \"1\" ? \"▲\" : \"▵\"}\n        </span>\n        <p className={styles.voteCount}>\n          {this.props.votes}\n          {/* {(this.props.votes || 0) +\n            (this.state.hasParentRefreshed &&\n            this.state.castedVoteValueAtMount === 0\n              ? 0\n              : this.state.castedVote) -\n            (this.state.castedVoteValueAtMount !== 0\n              ? this.state.castedVoteValueAtMount\n              : 0)} */}\n        </p>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            if (this.state.castedVote !== -1) {\n              this.handleVote(-1);\n            }\n          }}\n          role=\"img\"\n        >\n          {this.state.castedVote.toString() === \"-1\" ? \"▼\" : \"▿\"}\n        </span>\n      </p>\n    );\n  }\n}\n\nexport default VoteDisplayOnArticle;\n"]},"metadata":{},"sourceType":"module"}