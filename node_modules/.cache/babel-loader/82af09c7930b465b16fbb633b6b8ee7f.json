{"ast":null,"code":"var _jsxFileName = \"/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx\";\nimport React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\"; //The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      voteBuffer: 0,\n      voteNullifier: 0,\n      error: false,\n      hasParentRefreshed: true\n    };\n\n    this.sneakyUpwardChange = article_votes_junction => {\n      this.setState({\n        voteBuffer: article_votes_junction[0][\"inc_votes\"]\n      });\n    };\n\n    this.handleVote = voteDirection => {\n      if (this.props.currentUser !== null && this.props.currentUser !== undefined && this.props.currentUser !== \"\") {\n        const {\n          article_id,\n          currentUser\n        } = this.props; //Undoing the invalid double-vote the user just gave.\n\n        voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n          console.log(\"INSIDE CATCH BK\");\n          this.setState(currState => {\n            return {\n              error: true,\n              voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1),\n              hasParentRefreshed: false\n            };\n          });\n        }); //Ambicrementing the vote regardless.\n\n        this.setState(currState => {\n          console.log(`gonna set state with votedir ${voteDirection}`);\n          console.log(`VB CURRENTLY  ${this.state.voteBuffer}`);\n          console.log(`PV CURRENTLY  ${this.props.votes}`);\n          console.log(`TX CURRENTLY  ${this.state.hasParentRefreshed}`); //Check if nullifying\n\n          if (voteDirection === -1 && this.state.voteBuffer === 1 || voteDirection === 1 && this.state.voteBuffer === -1) {\n            this.setState(currState => {\n              return {\n                voteBuffer: 66,\n                hasParentRefreshed: false\n              };\n            });\n          } //If ambivoting de novo.\n          else return {\n              voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n              error: false,\n              hasParentRefreshed: false\n            };\n        }); // let newCastedVote = this.state.voteBuffer;\n        // if (newCastedVote < 1 && voteDirection === 1) {\n        //   newCastedVote++;\n        // } else if (newCastedVote > -1 && voteDirection === -1) {\n        //   newCastedVote--;\n        // }\n        // this.setState({ voteBuffer: newCastedVote });\n      } else {\n        alert(\"To vote on the latest news, log in or sign up!\");\n      }\n    };\n  }\n\n  componentDidMount() {\n    queryUserVoteOnArticle(this.sneakyUpwardChange, this.props.currentUser, this.props.article_id);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.refreshTicket !== this.props.refreshTicket) {\n      this.setState({\n        hasParentRefreshed: true\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(\"p\", {\n      className: styles.votes,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, console.log(`hasParentRefreshed ${this.state.hasParentRefreshed}`), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, this.state.voteBuffer === 1 ? \"▲\" : \"▵\"), console.log(`this.state.voteBuffer is ${this.state.voteBuffer}`), console.log(`this.props.votes is ${this.props.votes}`), console.log(this.props.refreshTicket), React.createElement(\"p\", {\n      className: styles.voteCount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, (this.props.votes || 0) + (this.state.hasParentRefreshed ? 0 : this.state.voteBuffer + this.state.voteNullifier)), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(-1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, this.state.voteBuffer === -1 ? \"▼\" : \"▿\"));\n  }\n\n}\n\nexport default VoteDisplayOnArticle;","map":{"version":3,"sources":["/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx"],"names":["React","Component","voteOnArticle","styles","queryUserVoteOnArticle","VoteDisplayOnArticle","state","voteBuffer","voteNullifier","error","hasParentRefreshed","sneakyUpwardChange","article_votes_junction","setState","handleVote","voteDirection","props","currentUser","undefined","article_id","catch","err","console","log","currState","votes","alert","componentDidMount","componentDidUpdate","prevProps","refreshTicket","render","voteEmoji","voteCount"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\";\n\n//The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  state = {\n    voteBuffer: 0,\n    voteNullifier: 0,\n    error: false,\n    hasParentRefreshed: true\n  };\n\n  sneakyUpwardChange = article_votes_junction => {\n    this.setState({ voteBuffer: article_votes_junction[0][\"inc_votes\"] });\n  };\n\n  componentDidMount() {\n    queryUserVoteOnArticle(\n      this.sneakyUpwardChange,\n      this.props.currentUser,\n      this.props.article_id\n    );\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.refreshTicket !== this.props.refreshTicket) {\n      this.setState({ hasParentRefreshed: true });\n    }\n  }\n\n  handleVote = voteDirection => {\n    if (\n      this.props.currentUser !== null &&\n      this.props.currentUser !== undefined &&\n      this.props.currentUser !== \"\"\n    ) {\n      const { article_id, currentUser } = this.props;\n\n      //Undoing the invalid double-vote the user just gave.\n      voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n        console.log(\"INSIDE CATCH BK\");\n        this.setState(currState => {\n          return {\n            error: true,\n            voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1),\n            hasParentRefreshed: false\n          };\n        });\n      });\n\n      //Ambicrementing the vote regardless.\n      this.setState(currState => {\n        console.log(`gonna set state with votedir ${voteDirection}`);\n        console.log(`VB CURRENTLY  ${this.state.voteBuffer}`);\n        console.log(`PV CURRENTLY  ${this.props.votes}`);\n        console.log(`TX CURRENTLY  ${this.state.hasParentRefreshed}`);\n\n        //Check if nullifying\n        if (\n          (voteDirection === -1 && this.state.voteBuffer === 1) ||\n          (voteDirection === 1 && this.state.voteBuffer === -1)\n        ) {\n          this.setState(currState => {\n            return { voteBuffer: 66, hasParentRefreshed: false };\n          });\n        }\n        //If ambivoting de novo.\n        else\n          return {\n            voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n            error: false,\n            hasParentRefreshed: false\n          };\n      });\n\n      // let newCastedVote = this.state.voteBuffer;\n\n      // if (newCastedVote < 1 && voteDirection === 1) {\n      //   newCastedVote++;\n      // } else if (newCastedVote > -1 && voteDirection === -1) {\n      //   newCastedVote--;\n      // }\n      // this.setState({ voteBuffer: newCastedVote });\n    } else {\n      alert(\"To vote on the latest news, log in or sign up!\");\n    }\n  };\n\n  render() {\n    return (\n      <p className={styles.votes}>\n        {console.log(`hasParentRefreshed ${this.state.hasParentRefreshed}`)}\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer === 1 ? \"▲\" : \"▵\"}\n        </span>\n        {console.log(`this.state.voteBuffer is ${this.state.voteBuffer}`)}\n        {console.log(`this.props.votes is ${this.props.votes}`)}\n        {console.log(this.props.refreshTicket)}\n        <p className={styles.voteCount}>\n          {/* {this.state.voteBuffer + (this.props.votes || 0)} */}\n          {(this.props.votes || 0) +\n            (this.state.hasParentRefreshed\n              ? 0\n              : this.state.voteBuffer + this.state.voteNullifier)}\n        </p>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(-1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer === -1 ? \"▼\" : \"▿\"}\n        </span>\n      </p>\n    );\n  }\n}\n\nexport default VoteDisplayOnArticle;\n"]},"metadata":{},"sourceType":"module"}