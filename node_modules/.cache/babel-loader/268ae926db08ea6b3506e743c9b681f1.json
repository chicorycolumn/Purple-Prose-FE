{"ast":null,"code":"var _jsxFileName = \"/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx\";\nimport React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\"; //The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      voteBuffer: 0,\n      error: false,\n      hasParentRefreshed: true\n    };\n\n    this.sneakyUpwardChange = article_votes_junction => {\n      console.log(`in SUC and VB: ${this.state.voteBuffer}`);\n      this.setState({\n        voteBuffer: article_votes_junction[0][\"inc_votes\"]\n      });\n    };\n\n    this.handleVote = voteDirection => {\n      console.log(`in handleVote and VB: ${this.state.voteBuffer}`); // if (\n      //   this.props.currentUser !== null &&\n      //   this.props.currentUser !== undefined &&\n      //   this.props.currentUser !== \"\"\n      // ) {\n\n      const {\n        article_id,\n        currentUser\n      } = this.props; //Undoing the invalid double-vote the user just gave.\n\n      voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n        console.log(`in catch and VB: ${this.state.voteBuffer}`);\n        this.setState(currState => {\n          return {\n            error: true,\n            voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1),\n            hasParentRefreshed: false\n          };\n        });\n      }); //If nullifying a previous vote:\n\n      if (voteDirection === -1 && this.state.voteBuffer === 1 || voteDirection === 1 && this.state.voteBuffer === -1) {\n        console.log(`in NULL PREV and VB: ${this.state.voteBuffer}`);\n        this.setState(currState => {\n          return {\n            voteBuffer: 0,\n            // voteBuffer: currState.voteBuffer + voteDirection,\n            hasParentRefreshed: false\n          };\n        });\n      } //If voting de novo:\n      else this.setState(currState => {\n          console.log(`in DE NOVO and VB: ${this.state.voteBuffer}`);\n          return {\n            voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n            error: false,\n            hasParentRefreshed: false\n          };\n        }); // let newCastedVote = this.state.voteBuffer;\n      // if (newCastedVote < 1 && voteDirection === 1) {\n      //   newCastedVote++;\n      // } else if (newCastedVote > -1 && voteDirection === -1) {\n      //   newCastedVote--;\n      // }\n      // this.setState({ voteBuffer: newCastedVote });\n      // } else {\n      //   alert(\"To vote on the latest news, log in or sign up!\");\n      // }\n\n    };\n  }\n\n  componentDidMount() {\n    console.log(`in CDMt and VB: ${this.state.voteBuffer}`);\n    queryUserVoteOnArticle(this.sneakyUpwardChange, this.props.currentUser, this.props.article_id);\n  }\n\n  componentDidUpdate(prevProps) {\n    console.log(`in CDUp and VB: ${this.state.voteBuffer}`);\n\n    if (prevProps.refreshTicket !== this.props.refreshTicket) {\n      this.setState({\n        hasParentRefreshed: true\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(\"p\", {\n      className: styles.votes,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, console.log(`RENDER. tx: ${this.state.hasParentRefreshed}, VB: ${this.state.voteBuffer}. PV: ${this.props.votes}.`), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, this.state.voteBuffer === 1 ? \"▲\" : \"▵\"), React.createElement(\"p\", {\n      className: styles.voteCount,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, (this.props.votes || 0) + (this.state.hasParentRefreshed ? 0 : this.state.voteBuffer)), React.createElement(\"span\", {\n      className: styles.voteEmoji,\n      onClick: () => {\n        this.handleVote(-1);\n      },\n      role: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, this.state.voteBuffer.toString() === \"-1\" ? \"▼\" : \"▿\"));\n  }\n\n}\n\nexport default VoteDisplayOnArticle;","map":{"version":3,"sources":["/home/heihachu/fe-news/src/VoteDisplayOnArticle.jsx"],"names":["React","Component","voteOnArticle","styles","queryUserVoteOnArticle","VoteDisplayOnArticle","state","voteBuffer","error","hasParentRefreshed","sneakyUpwardChange","article_votes_junction","console","log","setState","handleVote","voteDirection","article_id","currentUser","props","catch","err","currState","componentDidMount","componentDidUpdate","prevProps","refreshTicket","render","votes","voteEmoji","voteCount","toString"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { voteOnArticle } from \"./utils/patchUtils\";\nimport styles from \"./css/ArticlePreview.module.css\";\nimport { queryUserVoteOnArticle } from \"./utils/getUtils\";\n\n//The intention of all this is to check the actual number of votes an article has to display the user having voted new votecount.\n//It basically works, just that you don't see the visual feedback if you already have a downvote on sth, then refresh page (which sets voteBuffer to 0 instead of -1)\n//and so then yes the request is sent off fine, but you dont see the feedback. Should be resolvable by using jxn table that already exists to populate whether\n//up arrow should be red or blue kinda thing.\n\nclass VoteDisplayOnArticle extends Component {\n  state = {\n    voteBuffer: 0,\n    error: false,\n    hasParentRefreshed: true\n  };\n\n  sneakyUpwardChange = article_votes_junction => {\n    console.log(`in SUC and VB: ${this.state.voteBuffer}`);\n    this.setState({ voteBuffer: article_votes_junction[0][\"inc_votes\"] });\n  };\n\n  componentDidMount() {\n    console.log(`in CDMt and VB: ${this.state.voteBuffer}`);\n    queryUserVoteOnArticle(\n      this.sneakyUpwardChange,\n      this.props.currentUser,\n      this.props.article_id\n    );\n  }\n\n  componentDidUpdate(prevProps) {\n    console.log(`in CDUp and VB: ${this.state.voteBuffer}`);\n    if (prevProps.refreshTicket !== this.props.refreshTicket) {\n      this.setState({ hasParentRefreshed: true });\n    }\n  }\n\n  handleVote = voteDirection => {\n    console.log(`in handleVote and VB: ${this.state.voteBuffer}`);\n    // if (\n    //   this.props.currentUser !== null &&\n    //   this.props.currentUser !== undefined &&\n    //   this.props.currentUser !== \"\"\n    // ) {\n    const { article_id, currentUser } = this.props;\n\n    //Undoing the invalid double-vote the user just gave.\n    voteOnArticle(currentUser, article_id, voteDirection).catch(err => {\n      console.log(`in catch and VB: ${this.state.voteBuffer}`);\n      this.setState(currState => {\n        return {\n          error: true,\n          voteBuffer: currState.voteBuffer + (voteDirection === -1 ? 1 : -1),\n          hasParentRefreshed: false\n        };\n      });\n    });\n\n    //If nullifying a previous vote:\n    if (\n      (voteDirection === -1 && this.state.voteBuffer === 1) ||\n      (voteDirection === 1 && this.state.voteBuffer === -1)\n    ) {\n      console.log(`in NULL PREV and VB: ${this.state.voteBuffer}`);\n      this.setState(currState => {\n        return {\n          voteBuffer: 0,\n          // voteBuffer: currState.voteBuffer + voteDirection,\n          hasParentRefreshed: false\n        };\n      });\n    }\n    //If voting de novo:\n    else\n      this.setState(currState => {\n        console.log(`in DE NOVO and VB: ${this.state.voteBuffer}`);\n        return {\n          voteBuffer: currState.voteBuffer + (voteDirection === 1 ? 1 : -1),\n          error: false,\n          hasParentRefreshed: false\n        };\n      });\n    // let newCastedVote = this.state.voteBuffer;\n\n    // if (newCastedVote < 1 && voteDirection === 1) {\n    //   newCastedVote++;\n    // } else if (newCastedVote > -1 && voteDirection === -1) {\n    //   newCastedVote--;\n    // }\n    // this.setState({ voteBuffer: newCastedVote });\n    // } else {\n    //   alert(\"To vote on the latest news, log in or sign up!\");\n    // }\n  };\n\n  render() {\n    return (\n      <p className={styles.votes}>\n        {console.log(\n          `RENDER. tx: ${this.state.hasParentRefreshed}, VB: ${this.state.voteBuffer}. PV: ${this.props.votes}.`\n        )}\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer === 1 ? \"▲\" : \"▵\"}\n        </span>\n        <p className={styles.voteCount}>\n          {/* {this.state.voteBuffer + (this.props.votes || 0)} */}\n          {(this.props.votes || 0) +\n            (this.state.hasParentRefreshed ? 0 : this.state.voteBuffer)}\n        </p>\n        <span\n          className={styles.voteEmoji}\n          onClick={() => {\n            this.handleVote(-1);\n          }}\n          role=\"img\"\n        >\n          {this.state.voteBuffer.toString() === \"-1\" ? \"▼\" : \"▿\"}\n        </span>\n      </p>\n    );\n  }\n}\n\nexport default VoteDisplayOnArticle;\n"]},"metadata":{},"sourceType":"module"}